<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Minha Loja de Beleza — Produto</title>

  <!-- Fonte Inter -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="container">
    <header class="logo">Lume — Beleza</header>

    <section class="product-card">
      <img src="https://via.placeholder.com/420x280?text=Produto" alt="Produto" class="product-img" />
      <div class="product-info">
        <h1 class="product-title">Sérum Iluminador</h1>
        <p class="product-desc">Frasco 30ml — hidratação e brilho.</p>

        <div class="price-row">
          <div>Preço unitário:</div>
          <div id="unitPrice" class="price"></div>
        </div>

        <label for="quantity">Quantidade</label>
        <input id="quantity" type="number" min="1" value="1" />

        <div class="total-row">
          <div>Total a pagar</div>
          <div id="totalPrice" class="total"></div>
        </div>

        <button id="buyBtn" class="buy-btn">Comprar</button>
        <p class="hint">Após clicar em comprar, você será redirecionado para o checkout Mercado Pago.</p>
      </div>
    </section>
  </main>

  <script>
    // Preço unitário do produto
    const unitPrice = 59.90;

    const quantityInput = document.getElementById('quantity');
    const totalPriceEl = document.getElementById('totalPrice');
    const unitPriceEl = document.getElementById('unitPrice');
    const buyBtn = document.getElementById('buyBtn');

    // Função para formatar em BRL
    const fmtBRL = n => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(n);

    // Mostra o preço unitário
    unitPriceEl.textContent = fmtBRL(unitPrice);

    // Atualiza o total
    function updateTotal() {
      let q = parseInt(quantityInput.value, 10);
      if (!q || q < 1) { q = 1; quantityInput.value = 1; }
      const total = +(unitPrice * q).toFixed(2);
      totalPriceEl.textContent = fmtBRL(total);
    }

    // Atualiza quando muda a quantidade
    quantityInput.addEventListener('input', updateTotal);

    // Inicializa
    updateTotal();

    // Botão comprar (chama backend Render)
    buyBtn.addEventListener('click', async () => {
      const quantity = parseInt(quantityInput.value, 10) || 1;
      const title = document.querySelector('.product-title').textContent;

      try {
        const response = await fetch('https://minha-loja-beleza.onrender.com/create_preference', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ title, quantity, unitPrice })
        });

        const data = await response.json();

        if (data.init_point) {
          // Redireciona para checkout Mercado Pago
          window.location.href = data.init_point;
        } else {
          alert('Erro ao criar preferência de pagamento');
          console.log(data);
        }
      } catch (err) {
        console.error(err);
        alert('Erro de conexão com o servidor');
      }
    });
  </script>
</body>
</html>
